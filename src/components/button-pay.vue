<template>
  <button
    v-if="show"
    type="button"
    :class="className"
    :disabled="disabled"
    @click="click"
  >
    <span v-t="{ path: 'pay', args: args }" />
  </button>
</template>

<script>
import { mapState } from '@/utils/store'
export default {
  inject: ['$validator', 'submit'],
  computed: {
    ...mapState({ isSubmit: 'submit' }),
    ...mapState(['css']),
    ...mapState('options', { show: 'button' }),
    ...mapState('params', ['amount', 'amount_with_fee', 'currency']),
    ...mapState('css_variable', [
      'btn_success_gradient_enable',
      'btn_success_gradient_custom',
      'btn_success_bg_lighten',
    ]),
    className() {
      return [
        this.css.btn,
        this.css.bs,
        this.css.btnLg,
        'f-btn-block',
        this.css.submit,
        'f-button-pay',
        {
          'f-btn-gradient':
            this.btn_success_gradient_enable &&
            !this.btn_success_gradient_custom,
          'f-btn-gradient-custom':
            this.btn_success_gradient_custom &&
            !this.btn_success_gradient_enable,
          'f-btn-success-bg-lighten': this.btn_success_bg_lighten,
        },
      ]
    },
    disabled() {
      return !!this.errors.items.length && this.isSubmit
    },
    fullAmount() {
      if (!this.amount) {
        return false
      }
      return (this.amount_with_fee || this.amount) / 100
    },
    args() {
      return this.fullAmount ? [this.fullAmount, this.$t(this.currency)] : []
    },
  },
  methods: {
    click() {
      this.submit()
        .then(model => {
          this.$emit('success', model)
        })
        .catch(e => {
          if (e instanceof Error) console.log(e)
        })
    },
  },
}
</script>
