<template>
  <div class="f-form-fields">
    <f-form-group
      v-for="field in list"
      :key="field.name"
      v-model="params[field.name]"
      v-bind="field"
    />
  </div>
</template>

<script>
import { mapState } from '@/utils/store'

export default {
  props: {
    fields: {
      type: Array,
      default: () => [],
    },
  },
  computed: {
    ...mapState(['params']),
    list() {
      return this.parseFields(this.fields)
    },
  },
  methods: {
    parseFields(fields) {
      return fields.map(this.parseField)
    },
    parseField(attrs) {
      return {
        ...attrs,
        placeholder: '',
        component: attrs.type === 'date' ? 'date' : 'input',
        rules: this.parseValidate(attrs.validate),
        autocomplete: 'on',
      }
    },
    parseValidate(validate) {
      if (!validate) return ''

      const map = {
        min_length: 'min',
        max_length: 'max',
      }
      return validate
        .split(';')
        .map(item => {
          let [name] = item.split(':')

          return item.replace(name, map[name] || name)
        })
        .join('|')
    },
  },
}
</script>
