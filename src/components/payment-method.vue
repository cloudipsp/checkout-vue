<template>
  <div>
    <fields v-if="options.fields && !store.state.need_verify_code"></fields>
    <transition name="fade">
    <component
      :is="method"
      :key="method"
      :icons="options[method + '_icons']"
      :payment-systems="options[method]"
    ></component>
    </transition>
    <regular v-if="regular.insert && method === 'card'"></regular>
    <offer v-if="options.offerta_url"></offer>
    <div class="f-block">
      <div class="f-block-sm">
        <button v-if="options.button" @click="onSubmit()" type="button" :class="[$css.btn, $css.bs, $css.btnLg, 'f-btn-block', $css.submit]" :disabled="disabled">
          <span v-t="{path: 'pay', args: args}"></span>
        </button>
        <div v-if="options.cancel" class="f-text-center">
          <a :class="[$css.btn, 'f-btn-link']" href="" v-t="'cancel'" @click.prevent="onCancel()"></a>
        </div>
        <div class="f-hidden-desktop">
          <i class="f-icon f-icon-block f-i-security"></i>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  import Card from '@/components/card'
  import Emoney from '@/components/emoney'
  import Ibank from '@/components/ibank'
  import Cash from '@/components/cash'
  import Sepa from '@/components/sepa'
  import Regular from '@/components/regular'
  import Offer from '@/components/offer'
  import Fields from '@/components/payment-fields'

  export default {
    props: ['disabled'],
    data () {
      return {
      }
    },
    computed: {
      fullAmount: function () {
        let amount = parseInt(this.params.amount)
        let amountWithFee = parseInt(this.params.amount_with_fee)
        if (!amount) {
          return false
        }
        return (amountWithFee || amount) / 100
      },
      args: function () {
        return this.fullAmount ? [this.fullAmount, this.$t(this.params.currency)] : []
      },
      method: function () {
        return this.router.method
      }
    },
    components: {
      Card,
      Emoney,
      Ibank,
      Cash,
      Sepa,
      Regular,
      Offer,
      Fields
    },
    methods: {
      onSubmit: function(){
        this.$emit('on-submit')
      },
      onCancel: function(){
        this.$emit('on-cancel')
      }
    }
  }
</script>
